<%-include('head')%>
<%if(locals.auth){%>
   
    <%-include('nav')%>
    <%}else if(locals.auth===false){%>
       
        <%-include('nav2')%>
        <%}%>
 
        <header id="login-container">
            <div class="container pt-3 " >
               <div class="row justify-content-center">
                  
              <div class="col-lg-6">
               <div class="card shadow-lg border-0 rounded-lg mt-5 mb-5">
               <div class="card-header justify-content-center"><h3 class="font-weight-light my-4">Login Account</h3></div>
                <div class="card-body">

<form action="/login" method="POST">
    <div class="form-group">
        <div class="col-md-12">
    <label for="email">Username</label><br>
    <input type="text" class="form-control" name="username" id="username">
    </div>
    </div>
    <div name="emailerror" calss="email error" id="emailerror"></div>
    <br>
    <div class="form-group">
        <div class="col-md-12">
    <label for="password">Password</label><br>
    <input type="password" name="password" id="password" class="form-control">
    </div>
    </div>
    <div name="passworderror" class="password error" id="passworderror"></div>

    <br><br>
    <input type="submit" name="submit"
        class="btn btn-warning btn-block">
</form>
</div>

</div>
</div>
</div>
</div>
</header>

 <script>
    const form = document.querySelector('form')
    const emailerror = document.getElementById('emailerror')
    const passworderror = document.getElementById('passworderror')
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        emailerror.textContent = ''
        passworderror.textContent = ''
        name = form.username.value;
        password = form.password.value;
        try {
            const res = await fetch('/auth/login',
            {
                
                body: JSON.stringify({ name, password }),
                headers: { 'Content-Type': 'application/json' },
                method: "POST",})

            const data = await res.json();
            //console.log(data.error)
            console.log(data)
            if (data.error) {
                emailerror.style.color ="red"
                passworderror.style.color="red"
                if(data.error.email){
                emailerror.textContent = data.error.email
                document.getElementById('username').focus()}
                if(data.error.password){
                    passworderror.textContent = data.error.password
             document.getElementById('password').focus()
                        }
                 }            if (data.user) {
                location.assign('/')
            }

        }
        catch (err) {
            console.log(err)
        }

    })
</script>
 <%-include('footer')%>
